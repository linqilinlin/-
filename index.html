<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åµæ¶åŒ…èµ¢ - AIæ™ºèƒ½åå‡»åŠ©æ‰‹</title>
    <meta name="description" content="AIæ™ºèƒ½ç”Ÿæˆåµæ¶å›å¤ï¼Œè®©ä½ åœ¨ç½‘ç»œè¾©è®ºä¸­å æ®ä¸Šé£ï¼">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10B981;
            cursor: pointer;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10B981;
            cursor: pointer;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #10B981;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // SVGå›¾æ ‡ç»„ä»¶
        const Send = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9"></polygon>
            </svg>
        );

        const MessageCircle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"></path>
            </svg>
        );

        const History = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 3v5h5"></path>
                <path d="m3 8 4-4 4 4"></path>
                <path d="M14 21v-5h5"></path>
                <path d="m19 16-4 4-4-4"></path>
            </svg>
        );

        const Trash2 = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="m19,6v14c0,1.1-0.9,2-2,2H7c-1.1,0-2-0.9-2-2V6m3,0V4c0-1.1,0.9-2,2-2h4c1.1,0,2,0.9,2,2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Settings = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="m12 1 1.09 3.26L16 5l-1.26 3.74L17 10l-3.26 1.09L13 14l-3.74-1.26L7 14l1.09-3.26L5 10l1.26-3.74L4 6l3.26-1.09L8 2z"></path>
            </svg>
        );

        const QuarrelWinner = () => {
            const [opponentText, setOpponentText] = useState('');
            const [intensity, setIntensity] = useState(5);
            const [responses, setResponses] = useState([]);
            const [loading, setLoading] = useState(false);
            const [history, setHistory] = useState([]);
            const [showHistory, setShowHistory] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [apiKey, setApiKey] = useState('');

            // ä»localStorageåŠ è½½è®¾ç½®
            useEffect(() => {
                const savedHistory = localStorage.getItem('quarrel_history');
                const savedApiKey = localStorage.getItem('openrouter_api_key');
                
                if (savedHistory) {
                    setHistory(JSON.parse(savedHistory));
                }
                if (savedApiKey) {
                    setApiKey(savedApiKey);
                }
            }, []);

            // ä¿å­˜APIå¯†é’¥
            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('openrouter_api_key', key);
            };

            // ä¿å­˜åˆ°å†å²è®°å½•
            const saveToHistory = (data) => {
                const newHistory = [data, ...history].slice(0, 20);
                setHistory(newHistory);
                localStorage.setItem('quarrel_history', JSON.stringify(newHistory));
            };

            // ç”Ÿæˆåµæ¶å›å¤
            const generateResponses = async () => {
                if (!opponentText.trim()) {
                    alert('è¯·è¾“å…¥å¯¹æ–¹è¯´çš„è¯ï¼');
                    return;
                }

                if (!apiKey.trim()) {
                    alert('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®APIå¯†é’¥ï¼');
                    setShowSettings(true);
                    return;
                }

                setLoading(true);
                setResponses([]);

                try {
                    const intensityDescriptions = {
                        1: 'éå¸¸æ¸©å’Œã€ç¤¼è²Œ',
                        2: 'æ¸©å’Œã€æœ‰ç¤¼è²Œ',
                        3: 'ç¨æ˜¾ä¸æ»¡',
                        4: 'æœ‰äº›ç”Ÿæ°”',
                        5: 'æ˜æ˜¾ä¸æ»¡',
                        6: 'æ¯”è¾ƒæ„¤æ€’',
                        7: 'ç›¸å½“æ„¤æ€’',
                        8: 'éå¸¸æ„¤æ€’',
                        9: 'æåº¦æ„¤æ€’',
                        10: 'æš´æ€’ã€ä¸ç•™æƒ…é¢'
                    };

                    const prompt = `å¯¹æ–¹è¯´ï¼š"${opponentText}"

è¯·ä»¥${intensityDescriptions[intensity]}çš„è¯­æ°”ï¼Œç”Ÿæˆ3æ¡ä¸åŒé£æ ¼çš„å›å¤ã€‚è¦æ±‚ï¼š
1. å›å¤è¦æœ‰ç†æœ‰æ®ï¼Œé€»è¾‘æ¸…æ™°
2. è¯­æ°”ç¬¦åˆ${intensity}/10çš„å¼ºçƒˆç¨‹åº¦
3. æ¯æ¡å›å¤éƒ½è¦ä¸åŒçš„è§’åº¦å’Œé£æ ¼
4. å›å¤è¦ç®€æ´æœ‰åŠ›ï¼Œé€‚åˆå¾®ä¿¡èŠå¤©
5. ä¸è¦ä½¿ç”¨è¿‡æ¿€æˆ–ä¸å½“è¨€è¯­

è¯·ç›´æ¥è¿”å›3æ¡å›å¤ï¼Œæ¯æ¡å›å¤ç”¨åºå·æ ‡æ˜ï¼Œä¸è¦å…¶ä»–è§£é‡Šã€‚`;

                    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json',
                            'HTTP-Referer': 'https://github.com',
                            'X-Title': 'Quarrel-Winner'
                        },
                        body: JSON.stringify({
                            model: 'deepseek/deepseek-chat',
                            messages: [
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            temperature: 0.8,
                            max_tokens: 1000
                        })
                    });

                    if (!response.ok) {
                        if (response.status === 401) {
                            throw new Error('APIå¯†é’¥æ— æ•ˆï¼Œè¯·æ£€æŸ¥è®¾ç½®');
                        }
                        throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                    }

                    const data = await response.json();
                    const content = data.choices[0].message.content;
                    
                    // è§£æå›å¤
                    const responseLines = content.split('\n').filter(line => line.trim());
                    const parsedResponses = responseLines
                        .filter(line => /^\d+[.ã€]/.test(line.trim()))
                        .map(line => line.replace(/^\d+[.ã€]\s*/, '').trim())
                        .slice(0, 3);

                    if (parsedResponses.length === 0) {
                        const fallbackResponses = content.split('\n')
                            .filter(line => line.trim() && !line.includes('å›å¤') && !line.includes('è¦æ±‚'))
                            .slice(0, 3);
                        setResponses(fallbackResponses.length > 0 ? fallbackResponses : ['ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•']);
                    } else {
                        setResponses(parsedResponses);
                    }

                    // ä¿å­˜åˆ°å†å²è®°å½•
                    const historyItem = {
                        id: Date.now(),
                        timestamp: new Date().toLocaleString('zh-CN'),
                        opponent: opponentText,
                        intensity,
                        responses: parsedResponses.length > 0 ? parsedResponses : ['ç”Ÿæˆå¤±è´¥']
                    };
                    saveToHistory(historyItem);

                } catch (error) {
                    console.error('ç”Ÿæˆå¤±è´¥:', error);
                    setResponses([error.message || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–APIå¯†é’¥']);
                } finally {
                    setLoading(false);
                }
            };

            // æ¸…ç©ºå†å²è®°å½•
            const clearHistory = () => {
                setHistory([]);
                localStorage.removeItem('quarrel_history');
            };

            // å¤åˆ¶å›å¤åˆ°å‰ªè´´æ¿
            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                } catch (error) {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* å¤´éƒ¨ */}
                    <div className="bg-green-500 text-white p-4 sticky top-0 z-10 shadow-md">
                        <div className="max-w-md mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <MessageCircle size={24} />
                                <h1 className="text-lg font-semibold">åµæ¶åŒ…èµ¢</h1>
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setShowHistory(!showHistory)}
                                    className="p-2 rounded-full hover:bg-green-600 transition-colors"
                                >
                                    <History size={20} />
                                </button>
                                <button
                                    onClick={() => setShowSettings(!showSettings)}
                                    className="p-2 rounded-full hover:bg-green-600 transition-colors"
                                >
                                    <Settings size={20} />
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-md mx-auto p-4 space-y-6">
                        {/* è®¾ç½®é¢æ¿ */}
                        {showSettings && (
                            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                                <h3 className="font-semibold text-gray-800 mb-3">APIè®¾ç½®</h3>
                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-sm text-gray-600 mb-1">
                                            OpenRouter APIå¯†é’¥
                                        </label>
                                        <input
                                            type="password"
                                            value={apiKey}
                                            onChange={(e) => saveApiKey(e.target.value)}
                                            placeholder="è¾“å…¥ä½ çš„APIå¯†é’¥ (sk-or-v1-...)"
                                            className="w-full p-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-green-500"
                                        />
                                    </div>
                                    <div className="text-xs text-gray-500">
                                        <p>â€¢ å‰å¾€ <a href="https://openrouter.ai" target="_blank" className="text-green-600 underline">openrouter.ai</a> è·å–APIå¯†é’¥</p>
                                        <p>â€¢ å¯†é’¥å°†å®‰å…¨ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* å†å²è®°å½•é¢æ¿ */}
                        {showHistory && (
                            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className="font-semibold text-gray-800">å†å²è®°å½•</h3>
                                    {history.length > 0 && (
                                        <button
                                            onClick={clearHistory}
                                            className="text-red-500 p-1 rounded hover:bg-red-50"
                                        >
                                            <Trash2 size={16} />
                                        </button>
                                    )}
                                </div>
                                {history.length === 0 ? (
                                    <p className="text-gray-500 text-sm">æš‚æ— å†å²è®°å½•</p>
                                ) : (
                                    <div className="space-y-2 max-h-60 overflow-y-auto">
                                        {history.map((item) => (
                                            <div key={item.id} className="border-b border-gray-100 pb-2 last:border-b-0">
                                                <div className="text-xs text-gray-500 mb-1">{item.timestamp}</div>
                                                <div className="text-sm text-gray-700 truncate">å¯¹æ–¹ï¼š{item.opponent}</div>
                                                <div className="text-xs text-green-600">å¼ºåº¦ï¼š{item.intensity}/10</div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* APIå¯†é’¥æç¤º */}
                        {!apiKey && (
                            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div className="flex items-center gap-2 text-yellow-800">
                                    <Settings size={16} />
                                    <span className="text-sm font-medium">éœ€è¦é…ç½®APIå¯†é’¥</span>
                                </div>
                                <p className="text-xs text-yellow-700 mt-1">
                                    è¯·ç‚¹å‡»å³ä¸Šè§’è®¾ç½®æŒ‰é’®é…ç½®ä½ çš„OpenRouter APIå¯†é’¥æ‰èƒ½ä½¿ç”¨AIåŠŸèƒ½
                                </p>
                            </div>
                        )}

                        {/* è¾“å…¥åŒºåŸŸ */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                            <h2 className="text-lg font-semibold text-gray-800 mb-4">å¯¹æ–¹è¯´äº†ä»€ä¹ˆï¼Ÿ</h2>
                            
                            <textarea
                                value={opponentText}
                                onChange={(e) => setOpponentText(e.target.value)}
                                placeholder="è¾“å…¥å¯¹æ–¹è¯´çš„è¯..."
                                className="w-full h-24 p-3 border border-gray-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                maxLength={500}
                            />
                            
                            <div className="text-right text-xs text-gray-400 mt-1">
                                {opponentText.length}/500
                            </div>
                        </div>

                        {/* è¯­æ°”å¼ºçƒˆç¨‹åº¦ */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">è¯­æ°”å¼ºçƒˆç¨‹åº¦</h3>
                            
                            <div className="space-y-3">
                                <div className="flex justify-between text-sm text-gray-600">
                                    <span>æ¸©å’Œ</span>
                                    <span className="font-semibold text-green-600">{intensity}</span>
                                    <span>å¼ºçƒˆ</span>
                                </div>
                                
                                <input
                                    type="range"
                                    min="1"
                                    max="10"
                                    value={intensity}
                                    onChange={(e) => setIntensity(parseInt(e.target.value))}
                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                    style={{
                                        background: `linear-gradient(to right, #10B981 0%, #10B981 ${(intensity-1)*11.11}%, #E5E7EB ${(intensity-1)*11.11}%, #E5E7EB 100%)`
                                    }}
                                />
                                
                                <div className="flex justify-between text-xs text-gray-500">
                                    {[1,2,3,4,5,6,7,8,9,10].map(num => (
                                        <span key={num} className={intensity === num ? 'text-green-600 font-semibold' : ''}>
                                            {num}
                                        </span>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* ç”ŸæˆæŒ‰é’® */}
                        <button
                            onClick={generateResponses}
                            disabled={loading || !opponentText.trim() || !apiKey}
                            className={`w-full py-4 rounded-lg font-semibold text-white transition-all ${
                                loading || !opponentText.trim() || !apiKey
                                    ? 'bg-gray-400 cursor-not-allowed'
                                    : 'bg-green-500 hover:bg-green-600 active:bg-green-700 shadow-md hover:shadow-lg'
                            }`}
                        >
                            <div className="flex items-center justify-center gap-2">
                                <Send size={20} />
                                {loading ? 'æ­£åœ¨ç”Ÿæˆä¸­...' : 'å¼€å§‹åµæ¶ï¼'}
                            </div>
                        </button>

                        {/* å›å¤ç»“æœ */}
                        {responses.length > 0 && (
                            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">ğŸ”¥ åå‡»å›å¤</h3>
                                
                                <div className="space-y-4">
                                    {responses.map((response, index) => (
                                        <div key={index} className="border border-gray-100 rounded-lg p-3 hover:bg-gray-50 transition-colors">
                                            <div className="flex items-start justify-between mb-2">
                                                <span className="text-sm font-semibold text-green-600">å›å¤ {index + 1}</span>
                                                <button
                                                    onClick={() => copyToClipboard(response)}
                                                    className="text-xs text-gray-500 hover:text-green-600 transition-colors"
                                                >
                                                    å¤åˆ¶
                                                </button>
                                            </div>
                                            <p className="text-gray-800 leading-relaxed">{response}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* åº•éƒ¨è¯´æ˜ */}
                    <div className="max-w-md mx-auto p-4 text-center">
                        <p className="text-xs text-gray-500">
                            ğŸ’¡ ç†æ€§è¡¨è¾¾è§‚ç‚¹ï¼Œå’Œè°äº¤æµ
                        </p>
                        <p className="text-xs text-gray-400 mt-1">
                            ç”±AIæ™ºèƒ½ç”Ÿæˆ Â· ä»…ä¾›å¨±ä¹äº¤æµ
                        </p>
                    </div>
                </div>
            );
        };

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<QuarrelWinner />, document.getElementById('root'));
    </script>
</body>
</html>
